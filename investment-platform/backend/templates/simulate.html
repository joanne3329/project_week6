{% extends "base.html" %}
{% block title %}æŠ•è³‡æ¨¡æ“¬å·¥å…·{% endblock %}

{% block content %}
<div class="simulate-card">
  <h2>ğŸ“ˆ æŠ•è³‡æ¨¡æ“¬å·¥å…·</h2>
  <p>è¼¸å…¥è³‡ç”¢é…ç½®èˆ‡æœ¬é‡‘ï¼Œç³»çµ±å°‡é€²è¡Œ 5000 æ¬¡è’™åœ°å¡ç¾…æ¨¡æ“¬ï¼Œå¹«åŠ©ä½ äº†è§£å¯èƒ½çš„æŠ•è³‡çµæœã€‚</p>

  <!-- è¡¨å–® -->
  <form method="POST" class="simulate-form">
    <input type="number" name="initial" placeholder="æœ¬é‡‘ (æ–°å°å¹£)" value="100000" required>
    <input type="number" name="years" placeholder="æŠ•è³‡å¹´é™ (å¹´)" value="10" required>
    <input type="number" name="stock" placeholder="è‚¡ç¥¨ (%)" required>
    <input type="number" name="bond" placeholder="å‚µåˆ¸ (%)" required>
    <input type="number" name="etf" placeholder="ETF (%)" required>
    <button type="submit" class="btn">é–‹å§‹æ¨¡æ“¬</button>
  </form>

  {% if result %}
    <!-- æ¨¡æ“¬çµæœ -->
    <div class="result-box">
      <h3>ğŸ“Š æ¨¡æ“¬çµæœ</h3>
      <p>ğŸ’° æŠ•è³‡æœ¬é‡‘ï¼šæ–°å°å¹£ {{ result.initial | int }} å…ƒ</p>
      <p>â³ æŠ•è³‡å¹´é™ï¼š{{ result.years }} å¹´</p>
      <p>ğŸ“ˆ é æœŸå¹´åŒ–å ±é…¬ç‡ï¼šç´„ {{ result.expected_return }}%</p>
      <p>ğŸ“‰ é¢¨éšª (æ³¢å‹•ç‡)ï¼š{{ result.risk }}%</p>
      <p>â­ å¹³å‡ {{ result.years }} å¹´å¾Œè³‡ç”¢ï¼šç´„ æ–°å°å¹£ {{ result.mean_value | int }} å…ƒ</p>
      <p>ğŸ”» 10% åˆ†ä½æ•¸ï¼šç´„ æ–°å°å¹£ {{ result.percentile_10 | int }} å…ƒ</p>
      <p>ğŸ”º 90% åˆ†ä½æ•¸ï¼šç´„ æ–°å°å¹£ {{ result.percentile_90 | int }} å…ƒ</p>
    </div>

    <!-- åœ–è¡¨å€å¡Š -->
    <div class="charts">
      <div class="chart-container">
        <canvas id="pieChart"></canvas>
      </div>
      <div class="chart-container">
        <canvas id="histChart"></canvas>
      </div>
    </div>

    <div class="btn-box">
      <a href="{{ url_for('simulate.simulate') }}" class="btn">ğŸ”„ é‡æ–°æ¨¡æ“¬</a>
    </div>
  {% endif %}
</div>

<style>
  .simulate-card {
    background: #fff;
    max-width: 800px;
    margin: 40px auto;
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
    text-align: center;
  }
  .simulate-form {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin: 20px auto;
  }
  .simulate-form input {
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
  .btn {
    padding: 10px 20px;
    background: #3B82F6;
    color: #fff;
    border-radius: 8px;
    text-decoration: none;
    font-weight: bold;
    border: none;
    cursor: pointer;
  }
  .btn:hover {
    background: #2563EB;
  }
  .result-box {
    text-align: left;
    margin: 20px 0;
    background: #f9fafb;
    padding: 15px;
    border-radius: 10px;
  }
  .charts {
    display: flex;
    flex-direction: column; /* æ”¹æˆå‚ç›´ */
    gap: 25px;
    margin: 30px 0;
    align-items: center;
  }
  .chart-container {
    width: 400px; /* å›ºå®šå¤§å°è®“æ¯”ä¾‹ä¸€è‡´ */
    height: 300px;
  }
  .btn-box {
    margin-top: 20px;
    text-align: center;
  }
</style>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  {% if result %}
  // é…ç½®æ¯”ä¾‹åœ–
  new Chart(document.getElementById('pieChart'), {
    type: 'pie',
    data: {
      labels: ['è‚¡ç¥¨', 'å‚µåˆ¸', 'ETF'],
      datasets: [{
        data: [{{ result.stock }}, {{ result.bond }}, {{ result.etf }}],
        backgroundColor: ['#60A5FA', '#FCD34D', '#34D399'],
        borderWidth: 1
      }]
    },
    options: { responsive: true, maintainAspectRatio: false }
  });

  // åˆ†å¸ƒç›´æ–¹åœ–
  new Chart(document.getElementById('histChart'), {
    type: 'bar',
    data: {
      labels: {{ labels|safe }},
      datasets: [{
        label: 'æ¨¡æ“¬çµæœåˆ†å¸ƒ (æ¬¡æ•¸)',
        data: {{ values|safe }},
        backgroundColor: '#60A5FA88'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: { ticks: { autoSkip: true, maxRotation: 45 } },
        y: { beginAtZero: true }
      }
    }
  });
  {% endif %}
</script>
{% endblock %}
